_ = require 'underscore'
{ok, equal, deepEqual} = require 'assert'

reloaderService = require "../#{process.env.JSLIB or 'lib'}/services/reloader"
{hookService} = require './support/stubs'



usesHelpers = ->
  beforeEach ->
    _.extend this, Helpers

  Helpers =
    doesFoo: ->
      equal @foo, 42


describe "Reloader Service", ->

  beforeEach ->
    @reloader = hookService(reloaderService.create())

  it "should process a simple reload request", (done) ->
    @reloader.expect_send ['browser.reload', [{
      command:      'reload'
      path:         'foo.css'
      originalPath: ''
      liveCSS:      yes
      overrideURL:  undefined
    }]]
    @reloader.reload { changes: [{ path: 'foo.css' }] }, =>
      setTimeout done, 50
